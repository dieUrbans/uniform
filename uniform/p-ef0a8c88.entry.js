import{r as t,c as i,h as e,H as s,g as o}from"./p-86e9747e.js";let r=class{constructor(e){t(this,e),this.uSelect=i(this,"uSelect",7),this.uUnselect=i(this,"uUnselect",7),this.uStartHover=i(this,"uStartHover",7),this.uStopHover=i(this,"uStopHover",7),this.uLastElement=i(this,"uLastElement",7),this.resizeable=!1,this.selectable=!1,this.fixedHeader=!0,this.observe=!1,this.sort={dir:"none",prop:""},this.displayedData=JSON.parse(JSON.stringify(this.data||[])),this.selected=[],this.lastIndex=0,this.currentColWidth=0,this.nextColWidth=0,this.startOffset=0,this.currentCol=void 0,this.nextCol=void 0}watchData(t){this.displayedData=JSON.parse(JSON.stringify(t))}format(t){const i=[];for(let s of t.split("\n")){/(^\t)|(\t$)/g.test(s)&&(s=s.replace(/(^\t)|(\t$)/g,""));const t=[];/^\*.*\*$/g.test(s)&&(s=s.substring(1,s.length-1),t.push("bold")),/^_.*_$/g.test(s)&&(s=s.substring(1,s.length-1),t.push("underline")),/^\..*\.$/g.test(s)&&(s=s.substring(1,s.length-1),t.push("italic")),/^-.*-$/g.test(s)&&(s=s.substring(1,s.length-1),t.push("strike")),i.push(e("p",{class:t.join(" ")},s))}return i}handleSort(t,i){this.sort={dir:i,prop:t},"none"!==i?(this.selectable||(delete this.displayedData[this.lastIndex].select,this.uUnselect.emit()),this.displayedData=this.displayedData.sort(((e,s)=>"asc"===i?e[t]>s[t]?1:-1:"desc"===i?e[t]<s[t]?1:-1:0))):this.displayedData=[...this.data]}selectAll(){let t=!0;this.selected.length>0&&(this.selected=[],t=!1),this.displayedData=this.displayedData.map((i=>(t&&this.selected.push(i),i.select=t,i)))}selectRow(t,i,e){const s=this.selected.indexOf(t);if(this.selectable?(-1===s?(this.selected=[...this.selected,t],this.displayedData[i].select=!0):(this.selected=[...this.selected.slice(0,s),...this.selected.slice(s+1)],this.displayedData[i].select=!1),void 0!==e&&(this.displayedData[i].select=e)):(this.displayedData[i].select=!0,delete this.displayedData[this.lastIndex].select,this.selected=[t]),!this.selectable&&this.lastIndex===i)return this.uUnselect.emit(),void(this.lastIndex=i);this.lastIndex=i,this.uSelect.emit(this.selectable?this.selected:t)}handleShiftClick(t,i){if(!i.shiftKey||!this.selectable)return;const e=this.lastIndex>t?t:this.lastIndex,s=this.lastIndex>t?this.lastIndex:t,o=this.displayedData[this.lastIndex].select;this.displayedData=this.displayedData.map(((t,i)=>(i>e&&i<s&&(t.select=o,this.selectRow(t,i,o)),t))),this.lastIndex=t}async select(t){this.selectRow(this.displayedData[t],t)}async unselect(t){this.selectRow(this.displayedData[t],t)}createResize(t,i){t.style.position="relative",t.style.width=`${t.offsetWidth}px`;const e=document.createElement("div");e.innerHTML="&nbsp;",e.style.top="0",e.style.right="0",e.style.bottom="0",e.style.width="5px",e.style.height=i,e.className="columnSelector",e.style.position="absolute",e.style.cursor="col-resize",e.addEventListener("mousedown",(i=>{i.preventDefault(),this.currentCol=t,this.startOffset=i.pageX,this.nextCol=t.nextElementSibling,this.currentColWidth=this.currentCol.offsetWidth,this.nextCol&&(this.nextColWidth=this.nextCol.offsetWidth)})),t.appendChild(e)}componentDidLoad(){if(!this.resizeable)return;const t=this.el.shadowRoot.querySelector("tbody"),i=this.el.shadowRoot.querySelector("thead tr");this.el.shadowRoot.querySelectorAll("table th").forEach((e=>{this.createResize(e,`${t.offsetHeight+i.clientHeight}px`)})),this.el.shadowRoot.querySelectorAll("table td").forEach((t=>{t.style.width=`${t.offsetWidth}px`})),document.addEventListener("mousemove",(t=>{if(t.preventDefault(),this.currentCol){const i=t.pageX-this.startOffset;this.nextCol&&(this.nextCol.style.width=this.nextColWidth-i+"px"),this.currentCol.style.width=`${this.currentColWidth+i}px`}})),document.addEventListener("mouseup",(()=>{this.currentCol=void 0,this.nextCol=void 0}))}disconnectedCallback(){document.removeEventListener("mousemove",(()=>{})),document.removeEventListener("mouseup",(()=>{}))}render(){if(!this.data||!this.heading)return e("span",null,"loading ...");let t=this.heading.map((t=>t.field));return this.selectable&&(t=["select",...t]),e(s,null,e("table",null,e("thead",{class:{sticky:this.fixedHeader,top:!0}},e("tr",{class:"headingslot"},e("td",{colSpan:t.length},e("slot",{name:"header"}))),e("tr",{class:"heading"},this.heading.map(((t,i)=>{var s,o;return[this.selectable&&0===i&&e("th",{class:"center selectcell"},e("u-checkbox",{checked:this.selected.length>0,tristate:this.selected.length>0&&this.selected.length!==this.displayedData.length,onUChange:()=>this.selectAll()})),e("th",{class:{[null!==(s=t.align)&&void 0!==s?s:"left"]:!0},style:{width:null!==(o=t.width)&&void 0!==o?o:"100%"}},e("span",{class:"label"},t.label,t.sortable&&e("div",{class:"sort"},(this.sort.prop!==t.field||"none"===this.sort.dir)&&[e("span",{onClick:()=>this.handleSort(t.field,"asc")},"△"),e("span",{onClick:()=>this.handleSort(t.field,"desc")},"▽")],"asc"===this.sort.dir&&this.sort.prop===t.field&&[e("span",{onClick:()=>this.handleSort(t.field,"none")},"▲"),e("span",{onClick:()=>this.handleSort(t.field,"desc")},"▽")],"desc"===this.sort.dir&&this.sort.prop===t.field&&[e("span",{onClick:()=>this.handleSort(t.field,"asc")},"△"),e("span",{onClick:()=>this.handleSort(t.field,"none")},"▼")])))]})))),e("tbody",null,this.displayedData.map(((i,s)=>{const o=new Array(t.length);return Object.entries(i).forEach((([r,l])=>{const a=this.selectable?t.indexOf(r)+1:t.indexOf(r);if(this.selectable&&(o[0]=e("td",{class:{tablecell:!0,selectcell:!0,center:!0,selected:!0===i.select}},e("u-checkbox",{checked:!0===i.select,onUChange:()=>{this.selectRow(i,s)},onClick:t=>this.handleShiftClick(s,t)}))),a>-1&&"select"!==r){let t="100%",s="left",h="",n="";if(this.heading.length){const e=this.heading.find((t=>t.field===r));if(!e)return;const{width:o,align:l,bgcolor:a,fontcolor:c}=e;l&&(s=l),o&&(t=o),a&&(h=a(i)),c&&(n=c(i))}o[a]=e("td",{class:{tablecell:!0,[null!=s?s:"left"]:!0,selected:!0===i.select},style:{width:null!=t?t:"100%",backgroundColor:h,color:n}},this.format(l.toString()))}})),this.observe&&this.displayedData.length===s?e("u-observe",{onUVisble:()=>this.uLastElement.emit()},e("tr",{class:"tablerow",onClick:()=>{i.select=!i.select,this.selectRow(i,s)},onMouseEnter:()=>this.uStartHover.emit(i),onMouseLeave:()=>this.uStopHover.emit(i)},o)):e("tr",{class:"tablerow",onClick:()=>{i.select=!i.select,this.selectRow(i,s)},onMouseEnter:()=>this.uStartHover.emit(i),onMouseLeave:()=>this.uStopHover.emit(i)},o)}))),e("tfoot",null,e("slot",{name:"footer"}))))}get el(){return o(this)}static get watchers(){return{data:["watchData"]}}};r.style=":host{width:100%}table{border-collapse:separate;width:100%;height:100%;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;border-spacing:0 0.3rem}.heading{--tw-bg-opacity:1;background-color:rgba(71, 85, 105, var(--tw-bg-opacity));border-radius:0.5rem;display:table;--tw-text-opacity:1;color:rgba(241, 243, 245, var(--tw-text-opacity));width:100%}.headingslot{width:100%}th{--tw-bg-opacity:1;background-color:rgba(71, 85, 105, var(--tw-bg-opacity));height:100%;padding-left:0.25rem;padding-right:0.25rem;padding-top:0.5rem;padding-bottom:0.5rem;--tw-text-opacity:1;color:rgba(241, 243, 245, var(--tw-text-opacity));vertical-align:middle}th:last-child{padding-right:1rem}tbody{display:block;overflow-y:scroll;width:100%;-ms-flex:1 1 auto;flex:1 1 auto}thead{--tw-bg-opacity:1;background-color:rgba(255, 255, 255, var(--tw-bg-opacity));width:100%;-ms-flex:0 0 auto;flex:0 0 auto}.dark thead{--tw-bg-opacity:1;background-color:rgba(0, 0, 0, var(--tw-bg-opacity))}.dark tfoot{--tw-bg-opacity:1;background-color:rgba(0, 0, 0, var(--tw-bg-opacity))}tfoot{position:-webkit-sticky;position:sticky;bottom:0px;width:100%;inset-block-end:0}.tablerow{cursor:pointer;display:table;white-space:pre-wrap;width:100%}.tablerow:hover>.tablecell{--tw-border-opacity:1;border-color:rgba(148, 163, 184, var(--tw-border-opacity))}.tablecell{--tw-bg-opacity:1;background-color:rgba(226, 232, 240, var(--tw-bg-opacity));border-color:transparent;border-style:solid;border-top-width:2px;border-bottom-width:2px;border-left-width:0px;border-right-width:0px;-webkit-box-sizing:border-box;box-sizing:border-box;padding-left:0.5rem;padding-right:0.5rem;overflow-wrap:break-word}.selectcell{width:2.5rem}.sticky{position:-webkit-sticky;position:sticky;inset-block-start:0}.top{top:0px}.bottom{bottom:0px}.tablerow .tablecell:first-child,th:first-child{border-top-left-radius:0.75rem;border-bottom-left-radius:0.75rem;border-left-width:2px}.tablerow .tablecell:last-child,th:last-child{border-top-right-radius:0.75rem;border-bottom-right-radius:0.75rem;border-right-width:2px}p{margin:0px;padding:0px}.selected{--tw-bg-opacity:1;background-color:rgba(191, 219, 254, var(--tw-bg-opacity))}.bold{font-weight:700}.italic{font-style:italic}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.strike{-webkit-text-decoration-line:line-through;text-decoration-line:line-through}.center{text-align:center}.right{text-align:right}.left{text-align:left}.label{display:-webkit-inline-box;display:-ms-inline-flexbox;display:-webkit-inline-flex;display:inline-flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center;grid-gap:0.25rem;gap:0.25rem}.sort{display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;font-size:0.75rem;line-height:1rem;line-height:1;max-width:-webkit-max-content;max-width:-moz-max-content;max-width:max-content;--tw-text-opacity:1;color:rgba(222, 226, 230, var(--tw-text-opacity))}.sort>span{cursor:pointer}.columnSelector:hover{--tw-bg-opacity:1;background-color:rgba(156, 163, 175, var(--tw-bg-opacity))}";export{r as u_tablegen}